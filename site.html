<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boutique Diniz | Moda Feminina Exclusiva</title>

    <!-- PWA -->
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Boutique Diniz">
    <link rel="apple-touch-icon" href="logo.png">

    <link rel="icon" type="image/png" href="logo.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Satisfy&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" rel="stylesheet" />

    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: { background: "#000000", surface: "#0a0a0a", primary: "#ffffff", border: "#222" },
                    fontFamily: { logo: ["Satisfy", "cursive"], body: ["Montserrat", "sans-serif"] }
                }
            }
        }
    </script>

    <style>
        body { background-color: #000; color: #fff; overflow-x: hidden; font-family: 'Montserrat', sans-serif; }
        .font-logo { font-family: 'Satisfy', cursive; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        /* Hover nas fotos */
        .product-card .img-hover { opacity: 0; transition: opacity 0.5s ease, transform 0.5s ease; }
        .product-card:hover .img-hover { opacity: 1; transform: scale(1.05); }
        .product-card:hover .img-main { opacity: 0; }
        .img-main { transition: opacity 0.5s ease, transform 0.5s ease; }
        .product-card:hover .img-main-only { transform: scale(1.05); }

        /* Skeleton loader */
        .skeleton {
            background: linear-gradient(90deg, #111 25%, #1c1c1c 50%, #111 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
        }
        @keyframes shimmer { 0%{background-position:200% 0} 100%{background-position:-200% 0} }

        /* ─── POP-UP PWA ─── */
        #pwaPopup {
            position: fixed;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            z-index: 200;
            width: calc(100vw - 32px);
            max-width: 400px;
            background: rgba(10,10,10,0.88);
            backdrop-filter: blur(28px) saturate(180%);
            -webkit-backdrop-filter: blur(28px) saturate(180%);
            border: 1px solid rgba(255,255,255,0.12);
            border-radius: 22px;
            padding: 18px 18px 16px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.75), inset 0 1px 0 rgba(255,255,255,0.07);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease, transform 0.35s cubic-bezier(.34,1.4,.64,1);
        }
        #pwaPopup.visivel {
            opacity: 1;
            pointer-events: all;
            transform: translateX(-50%) translateY(0);
        }
        #pwaPopup .pwa-icon {
            width: 50px; height: 50px;
            border-radius: 13px;
            border: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0; overflow: hidden;
        }
        .pwa-ios-steps { font-size: 11px; color: #777; line-height: 1.8; margin-top: 10px; }
        .pwa-ios-steps span { color: #ccc; font-weight: 600; }
    </style>

    <script src="motor-ia.js"></script>
</head>
<body class="bg-background text-primary min-h-screen flex flex-col antialiased">

    <div id="app-header"></div>

    <main class="flex-grow pt-8 pb-10">

        <!-- BANNER -->
        <section class="w-full max-w-7xl mx-auto md:p-4 mb-10">
            <div id="bannerContainer" class="flex overflow-x-auto snap-x snap-mandatory no-scrollbar md:rounded-xl bg-surface gap-4">
                <div class="w-full h-48 md:h-[400px] flex-shrink-0 skeleton rounded-xl"></div>
            </div>
        </section>

        <!-- CATEGORIAS -->
        <section class="max-w-7xl mx-auto px-4 mb-14">
            <div class="flex items-center justify-between mb-5">
                <h2 class="text-xs uppercase tracking-[0.3em] text-gray-400">Nossas Categorias</h2>
                <a href="vitrine.categoria.html" class="flex items-center gap-0.5 text-[10px] uppercase tracking-widest text-gray-600 hover:text-white transition-colors group">
                    Ver todas <span class="material-symbols-outlined text-[15px] group-hover:translate-x-0.5 transition-transform">chevron_right</span>
                </a>
            </div>
            <div id="categoriasContainer" class="flex overflow-x-auto gap-5 snap-x snap-mandatory no-scrollbar pb-4">
                <div class="flex gap-5">
                    <div class="flex flex-col items-center gap-3 w-24"><div class="w-20 h-20 rounded-full skeleton"></div><div class="w-14 h-2.5 skeleton rounded"></div></div>
                    <div class="flex flex-col items-center gap-3 w-24"><div class="w-20 h-20 rounded-full skeleton"></div><div class="w-14 h-2.5 skeleton rounded"></div></div>
                    <div class="flex flex-col items-center gap-3 w-24"><div class="w-20 h-20 rounded-full skeleton"></div><div class="w-14 h-2.5 skeleton rounded"></div></div>
                    <div class="flex flex-col items-center gap-3 w-24"><div class="w-20 h-20 rounded-full skeleton"></div><div class="w-14 h-2.5 skeleton rounded"></div></div>
                </div>
            </div>
        </section>

        <!-- IA: SEPARADOS PARA VOCÊ -->
        <section id="sectionRecomendados" class="max-w-7xl mx-auto px-4 mb-16 hidden">
            <div class="flex items-center gap-2 mb-6 border-b border-gray-900 pb-3">
                <span class="material-symbols-outlined text-white/60 text-lg">auto_awesome</span>
                <h2 class="text-lg font-light text-white">Separados para Você</h2>
            </div>
            <div id="recomendadosContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"></div>
        </section>

        <!-- OFERTAS EXCLUSIVAS -->
        <section id="sectionDescontos" class="max-w-7xl mx-auto px-4 mb-16">
            <h2 class="text-lg font-light text-white mb-6">Ofertas Exclusivas</h2>
            <div id="descontosContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6">
                <div class="skeleton aspect-[3/4] rounded-lg"></div>
                <div class="skeleton aspect-[3/4] rounded-lg"></div>
                <div class="skeleton aspect-[3/4] rounded-lg hidden md:block"></div>
                <div class="skeleton aspect-[3/4] rounded-lg hidden md:block"></div>
            </div>
        </section>

        <!-- PRODUTOS AGRUPADOS POR CATEGORIA -->
        <section id="sectionCategorias" class="max-w-7xl mx-auto px-4 mb-16">
            <div id="produtosPorCategoriaContainer"></div>
        </section>

        <!-- VISTOS RECENTEMENTE -->
        <section id="sectionRecentes" class="max-w-7xl mx-auto px-4 mb-16 hidden">
            <h2 class="text-lg font-light text-white mb-6">Vistos Recentemente</h2>
            <div id="recentesContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"></div>
        </section>

        <!-- NOVIDADES (fallback) -->
        <section class="max-w-7xl mx-auto px-4 mb-16">
            <h2 class="text-lg font-light text-white mb-6" id="nomeCategoriaDestaque">Novidades</h2>
            <div id="produtosCategoriaContainer" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6"></div>
        </section>

    </main>

    <!-- ─── POP-UP PWA ─── -->
    <div id="pwaPopup" role="dialog" aria-modal="true" aria-label="Instalar aplicativo Boutique Diniz">
        <div class="flex items-start gap-4 mb-4">
            <img src="logo.png" alt="Logo" class="pwa-icon">
            <div class="flex-1 min-w-0">
                <p class="text-white font-bold text-sm">Instale o App</p>
                <p class="text-gray-500 text-[11px] mt-0.5 leading-relaxed" id="pwaSubtitulo">Boutique Diniz na sua tela inicial — acesso rápido, sem navegador.</p>
            </div>
            <button onclick="window.fecharPopupPWA()" aria-label="Fechar" class="text-gray-600 hover:text-white transition-colors mt-0.5 flex-shrink-0">
                <span class="material-symbols-outlined text-[20px]">close</span>
            </button>
        </div>

        <!-- Botão Android/Desktop -->
        <button id="pwaBtnInstalar" onclick="window.instalarPWA()"
            class="hidden w-full bg-white text-black font-bold uppercase tracking-widest text-xs py-3.5 rounded-xl hover:bg-gray-100 active:scale-[0.98] transition-all">
            <span class="material-symbols-outlined text-[15px] align-middle mr-1">install_mobile</span>
            Adicionar à Tela Inicial
        </button>

        <!-- Instrucoes iOS -->
        <div id="pwaIOSSteps" class="hidden pwa-ios-steps">
            <p>1. Toque em <span>Compartilhar</span> <span>⎙</span> na barra do Safari</p>
            <p>2. Role e toque em <span>"Adicionar à Tela de Início"</span></p>
            <p>3. Confirme tocando em <span>Adicionar</span></p>
        </div>
    </div>

    <div id="app-footer"></div>

    <script>
        // ─── PWA: captura evento e exibe popup ───
        let _pwaPrompt = null;

        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            _pwaPrompt = e;
            _exibirPWA('android');
        });

        function _isIOS() { return /iphone|ipad|ipod/i.test(navigator.userAgent) && !window.MSStream; }
        function _isStandalone() { return window.navigator.standalone === true || window.matchMedia('(display-mode: standalone)').matches; }

        function _exibirPWA(tipo) {
            if (_isStandalone()) return;
            const dispensado = localStorage.getItem('pwa_dispensado');
            if (dispensado && Date.now() - parseInt(dispensado) < 3 * 86400000) return;
            const popup = document.getElementById('pwaPopup');
            if (!popup) return;
            if (tipo === 'ios') {
                document.getElementById('pwaSubtitulo').textContent = 'Siga os passos abaixo para instalar no iPhone ou iPad via Safari.';
                document.getElementById('pwaIOSSteps').classList.remove('hidden');
            } else {
                document.getElementById('pwaBtnInstalar').classList.remove('hidden');
            }
            setTimeout(() => popup.classList.add('visivel'), 3000);
        }

        window.instalarPWA = async function() {
            if (!_pwaPrompt) return;
            _pwaPrompt.prompt();
            const { outcome } = await _pwaPrompt.userChoice;
            _pwaPrompt = null;
            window.fecharPopupPWA();
        };

        window.fecharPopupPWA = function() {
            const popup = document.getElementById('pwaPopup');
            if (popup) popup.classList.remove('visivel');
            localStorage.setItem('pwa_dispensado', String(Date.now()));
        };

        if (_isIOS() && !_isStandalone()) {
            setTimeout(() => _exibirPWA('ios'), 3000);
        }
    </script>

    <script type="module">
        import { inicializarLayout } from './layout.js';
        inicializarLayout();

        import('./buscador.js').catch(() => {});
        import('./site-logic.js').catch(() => {});
        import('./motor-pwa.js').then(m => { if (m.iniciarPWA) m.iniciarPWA(); }).catch(() => {});
    </script>

</body>
</html>
