<!DOCTYPE html>
<html lang="pt-BR" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checkout Seguro | Boutique Diniz</title>
    <meta name="robots" content="noindex, nofollow">
    <link rel="icon" type="image/png" href="logo.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Satisfy&family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,300,0,0" rel="stylesheet" />
    <style>
        body { background-color: #000; color: #fff; font-family: 'Montserrat', sans-serif; }
        .font-logo { font-family: 'Satisfy', cursive; }
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .payment-radio:checked + div { border-color: #fff !important; background-color: #111; }
        .payment-radio:checked + div .radio-dot { background-color: #fff; border-color: #fff; }
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #0a0a0a; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        .entrega-radio:checked + div { border-color: #fff !important; background-color: #0a0a0a; }
        .entrega-radio:checked + div .radio-dot { background-color: #fff; border-color: #fff; }
        .input-bd { width:100%; background:#111; border:1px solid #374151; border-radius:6px; padding:12px; font-size:14px; color:#fff; outline:none; transition: border-color .2s; }
        .input-bd:focus { border-color: #4ade80; }
        .select-bd { width:100%; background:#111; border:1px solid #374151; border-radius:6px; padding:12px; font-size:14px; color:#fff; outline:none; cursor:pointer; }
    </style>
    <script src="seguranca.js"></script>
</head>
<body class="bg-[#000000] text-white min-h-screen flex flex-col antialiased">

<div id="app-header"></div>

<main class="flex-grow pt-8 pb-16 max-w-4xl mx-auto w-full px-4">

    <!-- Loading -->
    <div id="loadingState" class="flex items-center justify-center py-20 flex-col gap-4">
        <span class="material-symbols-outlined animate-spin text-4xl text-gray-500">sync</span>
        <p class="text-xs uppercase tracking-widest text-gray-500">A preparar o seu pedido...</p>
    </div>

    <!-- ===== CHECKOUT FORM ===== -->
    <div id="checkoutForm" class="hidden flex-col gap-6">

        <div class="flex items-center gap-2 text-green-500 text-xs font-bold uppercase tracking-widest bg-green-900/20 px-4 py-2 rounded-full border border-green-900/30 w-max mx-auto mb-2">
            <span class="material-symbols-outlined text-[16px]">lock</span> Finaliza√ß√£o Segura
        </div>

        <!-- 1. ITENS -->
        <section class="bg-[#050505] border border-gray-900 rounded-lg p-6 shadow-lg">
            <h2 class="text-sm uppercase tracking-widest text-gray-400 mb-4 flex items-center gap-2 border-b border-gray-900 pb-3">
                <span class="material-symbols-outlined text-[18px]">shopping_bag</span> 1. Os Seus Looks
            </h2>
            <div id="listaItensCompra" class="flex flex-col gap-3 max-h-[300px] overflow-y-auto custom-scroll pr-1"></div>
        </section>

        <!-- 2. ENTREGA -->
        <section class="bg-[#050505] border border-gray-900 rounded-lg p-6 shadow-lg">
            <h2 class="text-sm uppercase tracking-widest text-gray-400 mb-5 flex items-center gap-2 border-b border-gray-900 pb-3">
                <span class="material-symbols-outlined text-[18px]">local_shipping</span> 2. Entrega
            </h2>

            <!-- Sele√ß√£o Tipo Entrega -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-5">
                <label class="cursor-pointer relative">
                    <input type="radio" name="tipo_entrega" value="correios" class="entrega-radio sr-only" checked onchange="window.calcularFrete()">
                    <div class="border border-gray-800 rounded-lg p-4 flex items-start gap-3 transition-colors hover:border-gray-600 h-full">
                        <div class="radio-dot w-4 h-4 rounded-full border-2 border-gray-600 transition-colors flex-shrink-0 mt-0.5"></div>
                        <div class="flex-1">
                            <h3 class="font-bold text-sm">Receber em Casa</h3>
                            <p class="text-xs text-gray-500 mt-1" id="txtEnderecoDestino">A carregar endere√ßo...</p>
                            <button type="button" onclick="window.abrirModalEnderecos()" class="mt-2 text-[10px] text-blue-400 hover:text-blue-300 underline uppercase tracking-wider flex items-center gap-1">
                                <span class="material-symbols-outlined text-[12px]">edit</span> Alterar endere√ßo
                            </button>
                        </div>
                    </div>
                </label>

                <label class="cursor-pointer relative">
                    <input type="radio" name="tipo_entrega" value="retirada" class="entrega-radio sr-only" onchange="window.calcularFrete()">
                    <div class="border border-gray-800 rounded-lg p-4 flex items-start gap-3 transition-colors hover:border-gray-600 h-full">
                        <div class="radio-dot w-4 h-4 rounded-full border-2 border-gray-600 transition-colors flex-shrink-0 mt-0.5"></div>
                        <div>
                            <h3 class="font-bold text-sm">Loja Envia em at√© 3 Horas</h3>
                            <p class="text-xs text-green-400 mt-1 font-semibold">Gr√°tis</p>
                            <p class="text-[10px] text-gray-500 mt-1">Entrega expressa pela pr√≥pria loja ap√≥s confirma√ß√£o</p>
                        </div>
                    </div>
                </label>
            </div>

            <!-- Resumo Frete -->
            <div id="boxCalculoFrete" class="bg-[#0a0a0a] p-4 rounded-lg flex justify-between items-center text-sm border border-gray-800">
                <span class="text-gray-400 flex items-center gap-2">
                    <span class="material-symbols-outlined text-[16px]">schedule</span>
                    <span id="labelFrete">Valor do Frete</span>
                </span>
                <span id="valorFreteUI" class="font-bold text-white">Calculando...</span>
            </div>

            <!-- Aviso motoboy (exibido condicionalmente via JS) -->
            <div id="avisoMotoboy" class="hidden mt-3 p-3 rounded-lg bg-blue-900/20 border border-blue-900/40 text-xs text-blue-300">
                üõµ <b>Entrega Local em Cachoeiro de Itapemirim:</b> A loja (D√©bora) entrar√° em contacto para combinar a entrega por motoboy.
            </div>
        </section>

        <!-- 3. PAGAMENTO -->
        <section class="bg-[#050505] border border-gray-900 rounded-lg p-6 shadow-lg">
            <h2 class="text-sm uppercase tracking-widest text-gray-400 mb-5 flex items-center gap-2 border-b border-gray-900 pb-3">
                <span class="material-symbols-outlined text-[18px]">payments</span> 3. Pagamento
            </h2>

            <!-- CPF -->
            <div class="mb-5 bg-[#0a0a0a] p-4 rounded-lg border border-gray-800">
                <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">CPF do Comprador *</label>
                <input type="text" id="cpfComprador" class="input-bd" placeholder="000.000.000-00" maxlength="14">
            </div>

            <!-- M√©todos -->
            <div class="grid grid-cols-2 md:grid-cols-5 gap-3 mb-5">
                <label class="cursor-pointer">
                    <input type="radio" name="metodo_pagamento" value="pix" class="payment-radio sr-only" checked onchange="window.alternarFormularioPagamento()">
                    <div class="border border-gray-800 rounded-lg p-3 text-center flex flex-col items-center justify-center gap-1.5 h-full bg-[#0a0a0a] hover:bg-[#111] transition-colors">
                        <img src="https://logospng.org/download/pix/logo-pix-icone-512.png" alt="PIX" class="h-6 opacity-80">
                        <span class="text-xs font-bold">PIX</span>
                    </div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="metodo_pagamento" value="credit" class="payment-radio sr-only" onchange="window.alternarFormularioPagamento()">
                    <div class="border border-gray-800 rounded-lg p-3 text-center flex flex-col items-center justify-center gap-1.5 h-full bg-[#0a0a0a] hover:bg-[#111] transition-colors">
                        <span class="material-symbols-outlined text-gray-400 text-[22px]">credit_card</span>
                        <span class="text-xs font-bold">Cr√©dito</span>
                    </div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="metodo_pagamento" value="debit" class="payment-radio sr-only" onchange="window.alternarFormularioPagamento()">
                    <div class="border border-gray-800 rounded-lg p-3 text-center flex flex-col items-center justify-center gap-1.5 h-full bg-[#0a0a0a] hover:bg-[#111] transition-colors">
                        <span class="material-symbols-outlined text-gray-400 text-[22px]">credit_card</span>
                        <span class="text-xs font-bold">D√©bito</span>
                    </div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="metodo_pagamento" value="boleto" class="payment-radio sr-only" onchange="window.alternarFormularioPagamento()">
                    <div class="border border-gray-800 rounded-lg p-3 text-center flex flex-col items-center justify-center gap-1.5 h-full bg-[#0a0a0a] hover:bg-[#111] transition-colors">
                        <span class="material-symbols-outlined text-gray-400 text-[22px]">receipt_long</span>
                        <span class="text-xs font-bold">Boleto</span>
                    </div>
                </label>
                <label class="cursor-pointer">
                    <input type="radio" name="metodo_pagamento" value="giftcard" class="payment-radio sr-only" onchange="window.alternarFormularioPagamento()">
                    <div class="border border-gray-800 rounded-lg p-3 text-center flex flex-col items-center justify-center gap-1.5 h-full bg-[#0a0a0a] hover:bg-[#111] transition-colors">
                        <span class="material-symbols-outlined text-gray-400 text-[22px]">card_giftcard</span>
                        <span class="text-xs font-bold">Gift Card</span>
                    </div>
                </label>
            </div>

            <!-- Aviso PIX -->
            <div id="avisoMetodo" class="hidden mb-4 p-3 rounded-lg bg-[#0a0a0a] border border-gray-800 text-xs text-gray-400"></div>

            <!-- Formul√°rio Cart√£o (cr√©dito e d√©bito) -->
            <div id="formCartao" class="hidden flex-col gap-4 bg-[#0a0a0a] p-5 rounded-lg border border-gray-800">
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">N√∫mero do Cart√£o</label>
                    <input type="text" id="ccNumero" class="input-bd" placeholder="0000 0000 0000 0000" maxlength="19">
                </div>
                <div>
                    <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">Nome Impresso no Cart√£o</label>
                    <input type="text" id="ccNome" class="input-bd uppercase" placeholder="NOME COMO NO CART√ÉO">
                </div>
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">Validade</label>
                        <input type="text" id="ccValidade" class="input-bd" placeholder="MM/AA" maxlength="7">
                    </div>
                    <div>
                        <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">CVV</label>
                        <input type="password" id="ccCvv" class="input-bd" placeholder="123" maxlength="4">
                    </div>
                    <div id="boxParcelas">
                        <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">Parcelas</label>
                        <select id="ccParcelas" class="select-bd">
                            <option value="1">1x sem juros</option>
                            <option value="2">2x sem juros</option>
                            <option value="3">3x sem juros</option>
                            <option value="4">4x sem juros</option>
                            <option value="5">5x sem juros</option>
                            <option value="6">6x sem juros</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Formul√°rio Gift Card -->
            <div id="formGiftCard" class="hidden flex-col gap-4 bg-[#0a0a0a] p-5 rounded-lg border border-gray-800">
                <p class="text-xs text-gray-400">Utilize o saldo do seu Cart√£o Presente Boutique Diniz.</p>
                <div class="grid grid-cols-3 gap-4">
                    <div class="col-span-2">
                        <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">N√∫mero do Cart√£o</label>
                        <input type="text" id="giftNumero" class="input-bd" maxlength="16" placeholder="0000 0000 0000 0000">
                    </div>
                    <div>
                        <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2">C√≥digo</label>
                        <input type="password" id="giftCvv" class="input-bd" maxlength="4" placeholder="0000">
                    </div>
                </div>
            </div>
        </section>

        <!-- 4. RESUMO E FINALIZAR -->
        <section class="bg-[#111] border border-gray-800 rounded-lg p-6 shadow-2xl">

            <!-- Cupom -->
            <div class="mb-6 flex gap-2 pb-6 border-b border-gray-800">
                <input type="text" id="inputCupom" class="w-full bg-[#0a0a0a] border border-gray-700 rounded-lg px-3 py-3 text-sm text-white outline-none focus:border-green-500 uppercase transition-colors" placeholder="CUPOM DE DESCONTO">
                <button onclick="window.aplicarCupom()" id="btnAplicarCupom" class="bg-gray-800 text-white px-5 rounded-lg text-xs font-bold uppercase tracking-widest hover:bg-gray-700 transition-colors whitespace-nowrap">Aplicar</button>
            </div>

            <div class="space-y-2 mb-2">
                <div class="flex justify-between items-center text-sm text-gray-400">
                    <span>Subtotal (<span id="qtdItens">0</span> itens)</span>
                    <span id="resumoSubtotal">R$ 0,00</span>
                </div>
                <div class="flex justify-between items-center text-sm text-gray-400">
                    <span>Frete</span>
                    <span id="resumoFrete">R$ 0,00</span>
                </div>
                <div id="linhaDesconto" class="hidden flex justify-between items-center text-sm text-green-400 pt-2 border-t border-gray-800">
                    <span>üéâ Desconto Aplicado</span>
                    <span id="resumoDesconto">- R$ 0,00</span>
                </div>
            </div>

            <div class="flex justify-between items-end mt-6 mb-8 pt-4 border-t border-gray-700">
                <span class="text-sm uppercase tracking-widest text-white">Total a Pagar</span>
                <span id="resumoTotal" class="text-4xl font-bold text-white tracking-tight">R$ 0,00</span>
            </div>

            <button id="btnPagar" class="w-full bg-green-600 text-white font-bold uppercase tracking-widest py-5 rounded-lg hover:bg-green-500 transition-colors flex items-center justify-center gap-2 shadow-lg shadow-green-900/20 text-sm">
                <span class="material-symbols-outlined">lock</span> Finalizar Pagamento
            </button>
            <p class="text-center text-[10px] text-gray-600 mt-3">Protegido por criptografia SSL ‚Äî Boutique Diniz</p>
        </section>
    </div>

    <!-- ===== TRANSA√á√ÉO ATIVA (PIX/Boleto) ===== -->
    <div id="transactionState" class="hidden flex-col items-center justify-center py-10 bg-[#0a0a0a] border border-gray-800 rounded-lg p-8 text-center shadow-2xl mt-8">

        <!-- PIX -->
        <div id="boxPix" class="hidden flex-col items-center gap-5 w-full">
            <h2 class="text-2xl font-bold text-green-400 font-logo">Quase l√°! Escaneie o QR Code.</h2>
            <p class="text-sm text-gray-400 mb-2">Voc√™ tem 15 minutos para pagar. A tela vai atualizar automaticamente.</p>
            <div class="bg-white p-3 rounded-xl shadow-lg">
                <img id="qrCodePix" src="" alt="QR Code PIX" class="w-56 h-56 object-contain">
            </div>
            <div class="w-full max-w-md mt-2">
                <label class="block text-[10px] uppercase tracking-widest text-gray-500 mb-2 text-left">Ou utilize o Copia e Cola:</label>
                <div class="flex shadow-lg">
                    <input type="text" id="copiaColaPix" readonly class="w-full bg-[#111] border border-gray-700 rounded-l px-4 py-3 text-xs text-gray-300 outline-none font-mono">
                    <button onclick="window.copiarPix()" class="bg-green-700 text-white font-bold px-5 rounded-r hover:bg-green-600 transition-colors uppercase tracking-widest text-xs whitespace-nowrap">Copiar</button>
                </div>
            </div>
            <div class="flex items-center gap-2 mt-4 text-sm text-yellow-500 bg-yellow-900/20 px-6 py-3 rounded-full border border-yellow-700/30">
                <span class="material-symbols-outlined text-[18px] animate-spin">sync</span> Aguardando identifica√ß√£o do banco...
            </div>
        </div>

        <!-- Boleto -->
        <div id="boxBoleto" class="hidden flex-col items-center gap-5 w-full">
            <h2 class="text-2xl font-bold text-green-400 font-logo">Boleto Gerado!</h2>
            <p class="text-sm text-gray-400 mb-4">O seu pedido foi reservado. O pagamento pode levar at√© 2 dias √∫teis para compensar.</p>
            <a id="linkBoleto" href="#" target="_blank" class="bg-white text-black px-8 py-4 rounded-lg font-bold uppercase tracking-widest hover:bg-gray-200 transition-colors shadow-lg">
                Imprimir / Ver Boleto
            </a>
            <div class="mt-8 pt-6 border-t border-gray-900 w-full">
                <button onclick="window.concluirPedidoBoleto()" class="text-gray-500 hover:text-white underline text-sm transition-colors">J√° paguei, concluir</button>
            </div>
        </div>
    </div>
</main>

<div id="app-footer"></div>

<!-- ===== MODAL: ALTERAR ENDERE√áO ===== -->
<div id="modalEnderecos" class="fixed inset-0 bg-black/90 z-[999] hidden items-center justify-center p-4 backdrop-blur-sm overflow-y-auto">
    <div class="bg-[#050505] border border-gray-800 w-full max-w-lg rounded-xl p-6 shadow-2xl my-8">

        <div class="flex justify-between items-center mb-5 border-b border-gray-900 pb-4">
            <h2 class="text-base font-bold text-white uppercase tracking-widest flex items-center gap-2">
                <span class="material-symbols-outlined text-[20px]">home</span> Endere√ßos de Entrega
            </h2>
            <button onclick="window.fecharModalEnderecos()" class="text-gray-500 hover:text-white transition-colors">
                <span class="material-symbols-outlined">close</span>
            </button>
        </div>

        <!-- Lista de endere√ßos existentes -->
        <div id="listaEnderecosModal" class="flex flex-col gap-3 mb-5 max-h-64 overflow-y-auto custom-scroll pr-1">
            <div class="text-center text-gray-500 text-sm py-4">Carregando...</div>
        </div>

        <!-- Formul√°rio novo endere√ßo -->
        <div id="boxNovoEndereco" class="hidden flex-col gap-3">
            <p class="text-[10px] uppercase tracking-widest text-gray-500 mb-1">Adicionar Novo Endere√ßo</p>

            <div class="grid grid-cols-2 gap-3">
                <div class="col-span-2">
                    <label class="block text-[10px] text-gray-500 mb-1">Tipo *</label>
                    <select id="novoEndTipo" class="select-bd">
                        <option value="casa">Casa</option>
                        <option value="trabalho">Trabalho</option>
                        <option value="outro">Outro</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="block text-[10px] text-gray-500 mb-1">CEP *</label>
                    <div class="flex gap-2">
                        <input type="text" id="novoEndCep" class="input-bd" placeholder="00000-000" maxlength="9">
                        <button onclick="window.buscarCep()" class="bg-gray-700 hover:bg-gray-600 text-white px-4 rounded text-xs font-bold uppercase tracking-widest whitespace-nowrap transition-colors">Buscar</button>
                    </div>
                </div>
                <div class="col-span-2">
                    <label class="block text-[10px] text-gray-500 mb-1">Rua *</label>
                    <input type="text" id="novoEndRua" class="input-bd" placeholder="Logradouro">
                </div>
                <div>
                    <label class="block text-[10px] text-gray-500 mb-1">N√∫mero *</label>
                    <input type="text" id="novoEndNumero" class="input-bd" placeholder="123">
                </div>
                <div>
                    <label class="block text-[10px] text-gray-500 mb-1">Complemento</label>
                    <input type="text" id="novoEndComplemento" class="input-bd" placeholder="Apto, bloco...">
                </div>
                <div>
                    <label class="block text-[10px] text-gray-500 mb-1">Bairro *</label>
                    <input type="text" id="novoEndBairro" class="input-bd" placeholder="Bairro">
                </div>
                <div>
                    <label class="block text-[10px] text-gray-500 mb-1">Estado *</label>
                    <select id="novoEndEstado" class="select-bd">
                        <option value="">UF</option>
                        <option>AC</option><option>AL</option><option>AP</option><option>AM</option>
                        <option>BA</option><option>CE</option><option>DF</option><option>ES</option>
                        <option>GO</option><option>MA</option><option>MT</option><option>MS</option>
                        <option>MG</option><option>PA</option><option>PB</option><option>PR</option>
                        <option>PE</option><option>PI</option><option>RJ</option><option>RN</option>
                        <option>RS</option><option>RO</option><option>RR</option><option>SC</option>
                        <option>SP</option><option>SE</option><option>TO</option>
                    </select>
                </div>
                <div class="col-span-2">
                    <label class="block text-[10px] text-gray-500 mb-1">Cidade *</label>
                    <input type="text" id="novoEndCidade" class="input-bd" placeholder="Cidade">
                </div>
            </div>

            <div class="flex gap-3 mt-2">
                <button onclick="window.salvarNovoEndereco()" class="flex-1 bg-white text-black font-bold uppercase tracking-widest py-3 rounded-lg text-xs hover:bg-gray-200 transition-colors">Salvar Endere√ßo</button>
                <button onclick="document.getElementById('boxNovoEndereco').classList.add('hidden')" class="px-4 py-3 border border-gray-700 text-gray-400 rounded-lg text-xs hover:border-gray-500 transition-colors">Cancelar</button>
            </div>
        </div>

        <button onclick="window.toggleNovoEndereco()" id="btnToggleNovoEnd" class="w-full border border-dashed border-gray-700 text-gray-500 hover:text-white hover:border-gray-500 py-3 rounded-lg text-xs uppercase tracking-widest transition-colors flex items-center justify-center gap-2 mt-2">
            <span class="material-symbols-outlined text-[16px]">add</span> Adicionar Novo Endere√ßo
        </button>
    </div>
</div>

<script type="module">
    import { inicializarLayout } from './layout.js';
    inicializarLayout();
    setTimeout(() => {
        import('./compra-logic.js').catch(e => console.error("Falha ao carregar motor", e));
    }, 150);
</script>
</body>
</html>
